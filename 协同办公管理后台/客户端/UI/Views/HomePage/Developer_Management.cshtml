@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
<html>
<head>
    <meta charset="utf-8">
    <title></title>
    <link href="~/layui/css/layui.css" rel="stylesheet" />
    <script src="~/js/jquery-3.3.1.js"></script>
    <style>
        h3 {
            border-color: #0079fe;
            border-left-style: solid;
            padding-left: 7px;
            border-width: 5px;
            margin-right: 20px;
            font-weight: 500;
            margin-top: 20px;
        }

        img {
            border-radius: 8px;
        }

        #Refresh {
            border-radius: 8px;
            border-color: rgb(228, 228, 228);
            border-style: solid;
            border-width: 0.5px;
            float: left;
            margin-left: 20px;
            margin-top: 28px;
        }

        #body {
            background-color: white;
            border-radius: 12px;
            margin-left: 15px;
            width: 90%;
            height: 700px;
        }

        #fun {
            padding-top: 10px;
            margin-left: 80px;
        }
    </style>
</head>
<body style="background-color: #f5f6f9;" onkeypress="search_enter()">
    <!--onkeypress是监听键盘输入-->
    <div style="margin-left: 20px;padding-bottom: 15px;">
        <h3>开发商管理</h3>
    </div>
    <div id="body">
        <div>
            <div id="Refresh">
                <img src="~/Img/刷新.png" height="36" width="46" />
            </div>
            <div id="fun">
                <button type="button" class="layui-btn layui-btn-normal">新增</button>
                <button type="button" class="layui-btn">编辑</button>
                <button type="button" class="layui-btn">开发商联系人</button>
                <button type="button" class="layui-btn layui-btn-danger">删除</button>
                <button type="button" class="layui-btn">导出</button>
                <input type="text" style="display: inline;width: 250px;margin-top: 16px;margin-left: 20px;" id="name" placeholder="🔍	名称/编码"
                       class="layui-input">
            </div>
            <div style="margin-left: 20px;width: 97%;">
                <table class="layui-hide" id="test" style="text-align:center;margin: 0 auto;"></table>
            </div>
        </div>
    </div>
    <!-- 添加弹出 -->
    <div id="Add" hidden="hidden">
        <form class="layui-form" id="addform" lay-filter="qwer">
            <!-- 提示：如果你不想用form，你可以换成div等任何一个普通元素 -->
            <div class="layui-form-item">
                <label class="layui-form-label"><strong style="color: red;">*</strong>开发商名称</label>
                <div class="layui-input-block">
                    <input type="text" name="Developers_Name" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">开发商编码</label>
                <div class="layui-input-block">
                    <input type="text" name="Developers_encoding" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">排序</label>
                <div class="layui-input-block">
                    <input type="text" name="Developers_sort" lay-verify="required" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label">备注</label>
                <div class="layui-input-block">
                    <textarea placeholder="请输入内容" name="Developers_synopsis" class="layui-textarea"></textarea>
                </div>
            </div>
            <!-- 更多表单结构排版请移步文档左侧【页面元素-表单】一项阅览 -->
        </form>
    </div>
    <!-- 修改弹出 -->
    <div id="Put" hidden="hidden">
        <form class="layui-form" id="addform" lay-filter="qwer">
            <!-- 提示：如果你不想用form，你可以换成div等任何一个普通元素 -->
            <div class="layui-form-item">
                <label class="layui-form-label"><strong style="color: red;">*</strong>开发商名称</label>
                <div class="layui-input-block">
                    <input type="hidden" id="DId" name="DId" class="layui-input">
                    <input type="text" name="Developers_Name" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">开发商编码</label>
                <div class="layui-input-block">
                    <input type="text" name="Developers_encoding" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">排序</label>
                <div class="layui-input-block">
                    <input type="text" name="Developers_sort" lay-verify="required" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label">备注</label>
                <div class="layui-input-block">
                    <textarea placeholder="请输入内容" name="Developers_synopsis" class="layui-textarea"></textarea>
                </div>
            </div>
            <!-- 更多表单结构排版请移步文档左侧【页面元素-表单】一项阅览 -->
        </form>
    </div>
</body>
</html>
<script src="~/layui/layui.all.js"></script>
<script>
    var table = layui.table;
    var layer = layui.layer;
    var form = layui.form;
    var upload = layui.upload;
    //表格加载
    tablers = table.render({
        elem: '#test',
        contentType: "application/x-www-form-urlencoded",
        url: "http://localhost:5000/api/ApplyManage/GetDevelopers",
        page: true //开启分页
        ,
        cols: [
            [ //表头
                {
                    type: 'checkbox'
                },
                {
                    field: 'dId',
                    title: '编号',
                    hide: true
                },
                {
                    field: 'developers_Name',
                    title: '开发商名称'
                },
                {
                    field: 'developers_encoding',
                    title: '开发商编码'
                }, {
                    field: 'developers_synopsis',
                    title: '备注'
                }, {
                    field: 'developers_sort',
                    title: '排序'
                }, {
                    field: 'developers_changetime',
                    title: '最后修改时间',
                    templet: function (d) {
                        return dateToStr(d.developers_changetime);
                    }
                }
            ]
        ]
    });
    //新增弹出层
    $("#fun button:first").click(function () {

        newadd = layer.open({
            type: 1,
            area: ['1000px', '700px'],
            btn: ['确定', '取消'],
            btn1: function (index, layero) { },
            btn2: function (index, layero) {
                layer.close(newadd);
            },
            title: "新增开发商",
            closeBtn: 1,
            success: function (layero, index) { // 成功弹出后回调
                document.getElementById("addform").reset()
                // 解决按enter键重复弹窗问题
                $(':focus').blur();
                // 添加form标识
                layero.addClass('layui-form');
                // 将保存按钮改变成提交按钮
                layero.find('.layui-layer-btn0').attr({
                    'lay-filter': 'addRole',
                    'lay-submit': ''
                })
            },
            content: $('#Add') //这里content是一个DOM，注意：最好该元素要存放在body最外层，否则可能被其它的相对元素所影响
        })
    })
    //刷新按钮点击
    $("#Refresh").click(function () {
        $("#name").val(null);
        tablers.reload({
            where: {
                Name: $("#name").val()
            }
            //,dataType: 'json'
            //,contentType: 'application/json'
            ,
            page: {
                curr: 1 //重新从第 1 页开始
            }
        });
        layer.msg("刷新成功！")
    })
    //删除
    $("#fun button:eq(3)").click(function () {
        var checkStatus = table.checkStatus('test'); //idTest 即为基础参数 id 对应的值
        if (checkStatus.data.length == 0) {
            layer.msg("您未选择任何项！");
            return;
        }
        layer.confirm('您确定要删除选中项吗？', {
            icon: 3,
            title: '警告'
        }, function (index) {
            console.log(checkStatus.data) //获取选中行的数据
            var str = "";
            $(checkStatus.data).each(function () {
                str += "," + this.dId;
            })
            $.ajax({
                url: "http://localhost:5000/api/ApplyManage/DelDevelopers?Ids=" + str,
                type: 'delete',
                //dataType: 'json',
                //contentType: 'application/json',
                success: function (result) {
                    if (result) {
                        tablers.reload();
                        layer.msg("删除成功！");
                    } else {
                        layer.msg("删除失败！");
                    }
                }
            });
            layer.close(index);
        });
    })
    //编辑
    $("#fun button:eq(1)").click(function () {
        var checkStatus = table.checkStatus('test'); //idTest 即为基础参数 id 对应的值
        if (checkStatus.data.length == 0) {
            layer.msg("您未选择任何项！");
            return;
        }
        if (checkStatus.data.length > 1) {
            layer.msg("请选择单项修改！");
            return;
        }
        put = layer.open({
            type: 1,
            area: ['1000px', '700px'],
            btn: ['确定', '取消'],
            btn1: function (index, layero) { },
            btn2: function (index, layero) {
                layer.close(put);
            },
            title: "编辑应用分类",
            closeBtn: 1,
            success: function (layero, index) { // 成功弹出后回调
                form.val("qwer", {
                    "DId": checkStatus.data[0].dId,
                    "Developers_Name": checkStatus.data[0].developers_Name,
                    "Developers_encoding": checkStatus.data[0].developers_encoding,
                    "Developers_sort": checkStatus.data[0].developers_sort,
                    "Developers_synopsis": checkStatus.data[0].developers_synopsis,
                })
                // 解决按enter键重复弹窗问题
                $(':focus').blur();
                // 添加form标识
                layero.addClass('layui-form');
                // 将保存按钮改变成提交按钮
                layero.find('.layui-layer-btn0').attr({
                    'lay-filter': 'PutRole',
                    'lay-submit': ''
                })
            },
            content: $('#Put') //这里content是一个DOM，注意：最好该元素要存放在body最外层，否则可能被其它的相对元素所影响
        })
    })
    //监听修改
    form.on('submit(PutRole)', function (data) {
        $.ajax({
            url: "http://localhost:5000/api/ApplyManage/PutDevelopers",
            type: 'put',
            data: JSON.stringify(data.field),
            dataType: 'json',
            contentType: 'application/json',
            success: function (result) {
                if (result) {
                    layer.close(put); //如果设定了yes回调，需进行手工关闭
                    tablers.reload();
                    layer.msg("修改成功！");
                } else {
                    layer.alert('修改失败！');
                }
            }
        });
        return false;
    });
    //监听添加提交
    form.on('submit(addRole)', function (data) {
        console.log(JSON.stringify(data.field));
        $.ajax({
            url: "http://localhost:5000/api/ApplyManage/AddDevelopers",
            type: 'post',
            data: JSON.stringify(data.field),
            dataType: 'json',
            contentType: 'application/json',
            success: function (result) {
                if (result) {
                    layer.close(newadd); //如果设定了yes回调，需进行手工关闭
                    tablers.reload();
                    layer.msg("添加成功！");
                } else {
                    layer.msg("添加失败！");
                }
            }
        });
        return false;
    });
    //敲回车键相当于确认键
    function search_enter() {
        //回车键的ASCII值是13
        if (event.keyCode == 13) { //判断按下的是否是回车键
            if (document.activeElement.id == "name") { //判断焦点是否选中
                tablers.reload({
                    where: {
                        Name: $("#name").val()
                    }
                    //,dataType: 'json'
                    //,contentType: 'application/json'
                    ,
                    page: {
                        curr: 1 //重新从第 1 页开始
                    }
                });
            }
        }
    }
    //日期戳格式化
    function dateToStr(dates) {
        var lw = new Date(dates);
        var lastY = lw.getFullYear();
        var lastM = lw.getMonth() + 1;
        var lastD = lw.getDate();
        var lastH = lw.getHours();
        var lastF = lw.getMinutes();
        var lastS = lw.getSeconds();
        var startdate = lastY + "-" + (lastM < 10 ? "0" + lastM : lastM) + "-" + (lastD < 10 ? "0" + lastD : lastD) + " " + (
            lastH < 10 ? "0" + lastH : lastH) + ":" + (lastF < 10 ? "0" + lastF : lastF) + ":" + (lastS < 10 ? "0" + lastS :
                lastS);
        return startdate;
    }
</script>
<script>
    // 上传图片鼠标移上事件
    $(document).ready(function () {
        $("#Refresh").mouseover(function () {
            $("#Refresh").css("border-color", "#0079fe");
        });
        $("#Refresh").mouseout(function () {
            $("#Refresh").css("border-color", "rgb(228, 228, 228)");
        });
    });
</script>